#dependencies needed:




#import necessary libraries for python discord bot
import os
import discord 
from dotenv import load_dotenv
from discord.ext import commands
from discord import app_commands

#get token and guild from .env file
load_dotenv()
TOKEN = os.getenv('DISCORD_TOKEN')
GUILD = os.getenv('DISCORD_GUILD')


#initialize discord client with intents
intents = discord.Intents.default()
intents.members = True #enable member intents
intents.message_content = True #enable message content intents

bot = commands.Bot(command_prefix='!', intents=intents) #create bot instance with command prefix '!'

#create discord client
#client = discord.Client(intents=intents)

    
@bot.event #For Emily my love <3
async def on_message(message):
    #ignore messages sent by the bot itself
    if message.author == bot.user:
        return
    
    #check if the message content is "amongus" (case-insensitive)
    if message.content.lower() == 'amongus':
        await message.channel.send(f'3(\\_)x(\\_)E') #reply with a gift

    await bot.process_commands(message) #process commands after handling the message event

#Create a bot command for the bot to respond to "!ping" with "Pong!"
@bot.command(name='bing')
async def ping(ctx):
    await ctx.send('Bing bong, Janice!') #reply with "Pong!" when the command is used


class AddDollarModal(discord.ui.Modal, title='Add a dollar to the jar'):
    label = discord.ui.TextInput(
        label='What did you do?',
        placeholder='describe the flavor of harassment...',
        required=True,
        max_length=200
    )
    async def on_submit(self, interaction: discord.Interaction):
        #Database save logic would go here, for now we just send a message with the input value
        await interaction.response.send_message(f'Dollar added for: {self.label.value}', ephemeral=False)

class JarView(discord.ui.View):
    def __init__(self):
        super().__init__(timeout=None) #set timeout to None to keep the view active indefinitely
        #self.value = None

    @discord.ui.button(label='Add a dollar', style=discord.ButtonStyle.green)
    async def add_dollar(self, interaction: discord.Interaction, button: discord.ui.Button):
        await interaction.response.send_modal(AddDollarModal())

@bot.tree.command(name='jar', description = "Open the dollar jar")
async def jar(interaction: discord.Interaction):
    view = JarView()
    await interaction.response.send_message('Dollar jar', view=view, ephemeral=False)
    

#event handler for when the bot is ready
@bot.event
async def on_ready():
    await bot.tree.sync() #sync the command tree to register slash commands
    print('slash commands synced!')
    #get the guild by name
    guild = discord.utils.get(bot.guilds, name=GUILD)
    #check if guild is found
    if guild is None:
        print(f'{GUILD} not found!')
        return
    #print guild and member information
    print(
        f'{bot.user} is connected to the following guild:\n'
        f'{guild.name} (id: {guild.id})'
    )
    #list all members in the guild
    members = '\n - '.join([member.name for member in guild.members]) #create list of member names
    print(f'Guild Members:\n - {members}') #print list of members

bot.run(TOKEN) #run the bot with the specified token
